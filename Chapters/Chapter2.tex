\chapter{The Behaviour of $\A_X^R$-Modules}
\todo[inline]{Mention BVWZ}
The classical approximation of the roots of the $b$-polynomial due to \cite{kashiwara1976b} relies on a quotient module $\int \M / \D_X u$ being holonomic.
This is no longer true in the multivariate case but a refined assumption, called relative holonomicity, due to \cite{maisonobe2016filtration} still holds.
This refinement works with $\D_X\times\C[s]$-modules whence one gets characteristic varieties inside $T^*X \times \C^p$\todo{p?}.

\todo{Maybe also mention the example Robin put on the whiteboard? Possibly in the main body? }
\section{Modules over $\A_X^R$}
Let $X$ be a smooth complex irreducible algebraic variety of dimension $n$ and denote $\D_X$ for it's sheaf of rings of algebraic differential operators.
For a regular commutative $\C$-algebra integral domain $R$ we define a sheaf of rings on $X\times \Spec R$ by
$$\A_{X}^R = \D_X \otimes_\C \O_{R}; \qquad \A_X = \A_{X}^{\C[s]}$$
where we abbreviated $\O_R = \O_{\Spec R}$.
The order filtration $F_p\D_X$ extends to a filtration $F_p\A^R_X = F_p\D_X \otimes_\C \O_R$ on $\A^R_X$ which is called the relative filtration.

The proof of the following results proceeds precisely like the case of $\D_X$-modules which may be found in \cite[Chapter 2]{hotta2007d}.
\begin{proposition}
    A quasi-coherent $\A_X^R$-module $\M$ is coherent if and only if it admits a filtration such that $\grrel \M$ is coherent over $\grrel \A_X^R$.
\end{proposition}
\begin{proposition}
    Let $\M$ be a coherent $\A_X^R$-module, then the support of $\grrel \M$ in $T^*X \times \Spec R$ is independent of the chosen filtration. It is called the characteristic variety of $\M$ and denoted $\Chrel \M$.
\end{proposition}

A coherent $\A_X^R$-module $\M$ is said to be relative holonomic over $R$ if $\Chrel \M = \cup_w \Lambda_w \times S_w$
for irreducible conic Lagrangian subvarieties $\Lambda_w\subseteq T^*X$ and irreducible closed subvarieties $S_w\subseteq \Spec R$.
\section{Direct Image Functor for $\A_X^R$-modules}
    In this section we state the natural generalisation of the direct image functor for $\D_X$-modules to the relative case of $\A_X^R$-modules. As with $\D$-modules this is the most natural for right-modules.\todo{more introduction}

    \subsection{Transfer Modules and $\A_Y^R$-module Direct Image}
    Let $\mu:Y\to X$ be some morphism of smooth algebraic varieties.  A-priori it is not even clear what $\A_X^R$-module should correspond to $\A_Y^R$ since there is no natural push forward of vector fields. This issue may be resolved by use of the transfer $(\A_Y^R,\mu^{-1}\A_X^R)$-bimodule $\A_{Y\to X}^R:= (\O_Y\times \O_R) \otimes_{\mu^{-1}(\O_X\times \O_R)}\mu^{-1}\A_X^R$.

    \begin{definition}
      The direct image functor $\int_\mu$ from $\bD^{b,r}(\A_Y^R)$ to $\bD^{b,r}(\A_X^R)$ is defined to be $\bR\mu_* (\blank\otimes_{\A_Y^R}^L \A_{Y\to X}^R)$.
      For any $\A_Y^R$ module $\M$ the $j$-th direct image is the $\A_X^R$-modules $\int_\mu^j \M = \H^j \int_\mu \M$.
      The subscript $\mu$ will be surpressed whenever there is no ambiguity.
    \end{definition}

    To compute $\int^j \M$ a resolution for $\A_{Y\to X}$ is required.
    \begin{definition}
        Let $\M$ be a right $\A_Y^R$-module, the relative Spencer complex $\Sp_Y^\bullet(\M)$ is a complex of right $\A_Y^R$-modules, concentrated in negative degrees, with $\Sp_Y^{-k}(\M) = \M \otimes_{\O_Y} \wedge^{k}\Theta_Y$ and as differential the right-$\A_Y^R$-linear map $\delta$ given by
        \begin{align*}
            m\otimes \xi_1 \wedge \cdots \wedge \xi_k &\mapsto \sum_{i<j}(-1)^{i+j} m \otimes [\xi_i,\xi_j]\wedge \xi_1 \wedge \cdots \wedge \widehat{\xi}_i \wedge\cdots \widehat{\xi}_j \wedge \cdots \wedge \xi_k\\
            &- \sum_{i=1}^k (-1)^{i} m\xi_i \otimes \xi_1 \wedge \cdots \wedge \widehat{\xi}_i\wedge \cdots \wedge \xi_k
        \end{align*}
    \end{definition}
        \begin{lemma}
            The complex of $(\A_X,f^{-1}\A_Y)$-bimodules $\Sp^\bullet_{Y\to X}(\A_Y^R) := \Sp^\bullet_Y(\A_Y^R) \otimes_{\O_Y}\A_{Y \to X}^R$ is a resolution of $\A_{Y\to X}^R$ as a bimodule by locally free left $\A_Y^R$-modules.
        \end{lemma}
        \begin{proof}
            This will be analogous to the case of $\D_Y$-modules in \cite[p33]{sabbah2011introduction}.\todo{Work out the appropriate exercises in the reference sometime.}
            Also see \url{http://www.math.stonybrook.edu/~cschnell/mat615/lectures/lecture17.pdf}
        \end{proof}
        Since tensoring with locally free modules yields a exact functor this simplifies the computation of the direct image as follows.
        \begin{corollary}
            It holds that $\int = \bR\mu_* (\blank\otimes_{\A_Y^R} \Sp_{Y\to X}^\bullet(\A_Y^R))$.
        \end{corollary}
        \begin{lemma}
            Construction of global section in $\int^j \M$.
        \end{lemma}
        \begin{theorem}
          Long exact sequence
        \end{theorem}
        \subsection{Functorial Properties of the Direct Image}
        \begin{theorem}
           Let $\mu:Z\to Y$ and $\nu:Y\to X$ be morphisms of smooth algebraic varieties. If $\mu$ is proper then $\int_{\nu\circ \mu} = \int_\nu \int_\mu$.
        \end{theorem}
        \begin{proof}
          See \url{http://www.math.stonybrook.edu/~cschnell/mat615/lectures/lecture17.pdf}
        \end{proof}
        This theorem reduces the computation of direct images to closed embeddings and projections by writing $\mu = \pi \circ \iota$ for $\iota:Y\to Y\times X$ and $\pi:Y\times X\to X$.
        %These cases are handled by the following theorem.
        %\begin{theorem}
        %   If $\iota: Y\to X$ is a closed embedding then $\int_\iota = \iota_*(\blank \otimes_{\A_{Y}} \A_{Y\to X})$.
        %   If $\pi:Y\times X \to X$ is the projection then $\int_\pi = \bR \pi_*(\blank \otimes_{\O_{Y\times X}} \wedge^{-\bullet}\Theta_{Y\times X/X}) $.\todo{Still need to adjust $\pi$ formula for relativity}
        %\end{theorem}



    Denote by $\bD^{b,r}_{qc}(\A_Y^{R})$ the full subcategory of $\bD^{b,r}(\A_Y^R)$ consisting of those complexes of right $\A_Y^R$-modules whose cohomology sheaves are quasi-coherent over $\O_Y\times \O_{\Spec R}$. Similarly for $\bD^{b,r}_{coh}(\A_Y^R)$ with the cohomology being coherent $\A_Y^R$-modules.
    \begin{theorem}\label{thm: ConservationQuasiCoherentAndCoherentIfProper}
        Let $\mu:X\to Y$ be a morphism of nonsingular algebraic varieties. Then the direct image $\int$ takes $\bD^{b,r}_{qc}(\A_Y^{R})$ into $\bD^{b,r}_{qc}(\A_X^{R})$. Moreover, when $\mu$ is proper the direct image takes $\bD^{b,r}_{coh}(\A_Y^R)$ into $\bD^{b,r}_{coh}(\A_X^R)$.
    \end{theorem}
    \begin{proof}
      See \url{http://www.math.stonybrook.edu/~cschnell/mat615/lectures/lecture18.pdf}
    \end{proof}
\subsection{Kashiwara's Estimate for the Characteristic Variety}
Let $\mu:Y\to X$ be a proper morphism of smooth algebraic varieties. Given a coherent $\A_X^R$-module $\M$ with relative characteristic variety $\Chrel \M$. We desire to estimate $\Chrel \int^j \M$ in terms of $\M$. Such a estimate in the non-relative case is known due to Kashiwara \cite{kashiwara1976b}. %

The original proof by \cite{kashiwara1976b} uses the theory of microlocal differential operators. The idea of the following proof is due to \cite{malgrange1985images} in a $K$-theoretic context and we follow the exposition by \cite{sabbah2011introduction}. %We note that the assumption that $\mu$ is proper can be relaxed but this version will suffice for our purposes.

Consider the following cotangent diagram
$$
\begin{tikzcd}
    & \mu^* T^* X\times \Spec R \arrow[swap]{ld}{T^* \mu} \arrow{rd}{\widetilde{\mu}} & \\
    T^* Y\times \Spec R & & T^*X\times \Spec R
\end{tikzcd}
$$
where the maps $T^*\mu$ and $\widetilde{\mu}$ act on the first component.
\begin{theorem}
    Let $\M$ be a coherent $\A_Y^R$-module. Then, for any $j\geq 0$, we have 
    $$\Chrel\left(\int^j \M \right)\subseteq  \widetilde{\mu}\left((T^*\mu)^{-1}(\Chrel \M) \right).$$
\end{theorem}
Note that the statement is local so, after replacing $X$ by some affine open, we may assume that $X\times \Spec R$ and $Y\times \Spec R$ are compact.

The first step is to note that a similar inclusion is easy for the $\grrel \A_Y^R$-modules. For any $\grrel \A_Y^R$-module $\mathcal{M}$ define $\int^j \mathcal{M} :=  \H^j\left(\bR \mu_* (\bL(T^*\mu)^* \mathcal{M})\right).$
Note that $(T^*\mu)^*$ produces a sheaf on $\mu^* T^* X \times \Spec R$ by the tensor product  $\blank\otimes_{f^{-1}\O_X\times \O_{R}} \grrel \A_X^R$. Hence, looking at the supports, the following result is immediate.
\begin{lemma}
    For any $\grrel\A_Y^R$-module $\mathcal{M}$ it holds that
    $$\Supp \int^j \mathcal{M}\subseteq \widetilde{\mu}\left((T^* \mu)^{-1} \Supp \mathcal{M}\right).$$
\end{lemma}
Applying this to $\grrel \M$ it remains to understand the difference between $\grrel\int^j \M$ and $\int^j \grrel \M$. This may be done using relative Rees modules.
\begin{definition}
    Let $z$ be a new variable. The relative Rees sheaf of rings $\Rees\A_Y^R$ is defined as the subsheaf $\oplus_p F_p \A_Y^R z^p $ of $\A_Y^R \otimes_\C \C[z]$. Similarly, any filtered $\A_Y^R$-module $\M$ gives rise to a $\Rees\A_Y$-module $\Rrel\M := \oplus_p F_p \M z^p$.
\end{definition}
The following obvious isomorphisms of filtered modules allow us to view the relative Rees module as a way to interpolate between $\M$ and $\grrel\M$
$$\frac{\Rrel\M}{(z-1)\Rrel\M} \cong \M; \qquad \frac{\Rrel\M}{z\Rrel\M} = \grrel \M.$$
Conversely, the second formula may be used to produce a filtered $\A_Y^R$-module from any graded $\Rees\A_Y^R$-module without $\C[z]$-torsion.

One can define a direct image of $\Rees\A_Y^R$-modules similarly to the $\A_Y^R$-module direct image and this preserves are coherence and being graded similarly to \cref{thm: ConservationQuasiCoherentAndCoherentIfProper}. \todo{Check that direct image yields graded structure}
%The idea is that, up to $\C[z]$-torsion $\int^j \Rrel \M$ to compare $\int^j \M$ and $\int^j \grrel \M$ but some care is required since $\int^j \Rrel \M$ may have $\C[z]$-torsion.

\begin{lemma}
  For sufficiently large $\ell$ the kernel of $z^\ell$ in $\int^j \Rrel \M$ stabilises. For such $\ell$ the quotient $\int^j \Rrel \M/ \ker z^\ell$ is the $\Rees \A_X^R$-coherent module associated to a good filtration on $\int^j \M$.
\end{lemma}
\begin{proof}
  By $\int \Rrel \M$ being coherent over the sheaf of Noetherian rings $\Rees\A_X^R$ one gets that $\ker z^\ell$ locally stabilises. This is sufficient due to $X\times \Spec R$ being compact.

    Now consider the short exact sequence $0\to \Rrel \M \xrightarrow{z-1} \Rrel \M \to \M \to 0$. This induces a long exact sequence
    $$\cdots \to \int^j \Rrel \M \xrightarrow{z-1} \int^j \Rrel \M \to \int^j \M \to \int^{j+1} \Rrel \M \xrightarrow{z-1}\cdots. $$
    Since $\int^{j+1} \Rrel \M$ is a graded $\Rees\A_X^R$-module one has that $z-1$ is injective whence it follows that $\int^j \Rrel \M / (z-1)\int^j \Rrel \M \cong \int^j \M$. This yields the desired result using that $\int^j \Rrel \M / \ker z^\ell$ is $\C[z]$-torsion free and the isomorphism
    $$ \frac{\int^j \Rrel \M }{(z-1)\int^j \Rrel \M } \cong \frac{\int^j \Rrel \M /\ker z^\ell }{(z-1)(\int^j \Rrel \M/\ker z^\ell) }.$$
\end{proof}
\todo{Implicitly, in this proof the direct image for Rees and standard is identified. Should verify that this causes no problems. }
From now on we equip $\int^j \M$ with the good filtation inherited from the Rees module's direct image.
\begin{lemma}
    If $\ell$ is sufficiently large then $\Rrel \int^j\M / z^\ell \Rrel \int^j \M$ is a subquotient of $\int^j \Rrel\M / z^\ell\int^j \Rrel \M$.
\end{lemma}
\begin{proof}
  The short exact sequence $0\to \Rrel\M \xrightarrow{z^\ell}\Rrel \M \to \Rrel\M / z^\ell \Rrel\M \to 0$ induces a long exact sequence
  $$\cdots \to \int^j \Rrel \M \xrightarrow{z^\ell} \int^j \Rrel \M \to \int^j \Rrel\M/z^\ell \Rrel\M \to \int^{j+1} \Rrel \M \xrightarrow{z^\ell}\cdots. $$
  Hence, $\int^j \Rrel \M / z^\ell \int^j \Rrel \M$ is a submodule of $\int^j \Rrel\M/z^\ell \Rrel\M$ and it remains to show that $\Rrel \int^j \M/ z^\ell \Rrel \int^j \M$ is a quotient of $\int^j \Rrel \M / z^\ell \int^j \Rrel \M$.

  Let $\ell$ be sufficiently large so that the foregoing lemma yields a isomorphism $\int^j \Rrel \M / \ker z^\ell \cong \Rrel\int^j \M$. The map $z^\ell$ induces a isomorphism $\int^j \Rrel \M / \ker z^\ell \cong z^\ell \int^j \Rrel \M$. Therefore $z^\ell \int^j \Rrel \M / z^{2\ell}\int^j \Rrel\M \cong \Rrel \int^j \M / z^\ell \Rrel\int^j \M $ so that the desired quotient follows by applying $z^\ell$ to $\int^j \Rrel \M / z^\ell \int^j \Rrel \M$.


\end{proof}
